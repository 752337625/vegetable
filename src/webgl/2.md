---
prev: false
next: false
category:
  - WebGL
tag:
  - WebGL
---

# WebGL 渲染

<!-- more -->

## WebGL 重置画布尺寸

每个画布都有两个尺寸，一个是 drawingbuffer 的尺寸， 这个表示画布中有多少个像素。另一是画布显示的尺寸， CSS 决定画布显示的尺寸。

### drawingbuffer

- 使用 HTML 设置

```html:no-line-numbers
<canvas id="c" width="400" height="300"></canvas>
```

- 使用 JavaScript 设置

```html:no-line-numbers
<canvas id="c" ></canvas>
```

```js:no-line-numbers
var canvas = document.querySelector("#c");
canvas.width = 400;
canvas.height = 300;
```

如果你没有使用 CSS 影响到画布的显示尺寸，画布的显示尺寸则和 drawingbuffer 尺寸相同。 所以在上述两个例子中画布的 drawingbuffer 尺寸和显示尺寸都是 400x300。

### 画布的显示尺寸

- 使用 HTML 设置

```html:no-line-numbers
<canvas id="c"  style="width: 400px; height: 300px;"></canvas>
```

- 使用 style 设置

```html:no-line-numbers
<canvas id="c" ></canvas>
```

```css:no-line-numbers
#c {
  width: 400px;
  height: 300px;
}
```

## 画布的显示尺寸 不等于 drawingbuffer 得后果

```html:no-line-numbers
<canvas id="canvas" width="10" height="15" style="width: 400px; height: 300px;"></canvas>
```

[后果](https://webglfundamentals.org/webgl/webgl-10x15-canvas-400x300-css.html)

## 为什么它被模糊了？

因为浏览器得到 10x15 像素的画布，将它拉伸到 400x300 像素， 然后在拉伸的过程中进行了插值。

## 如果防止模糊

设置画布的显示尺寸 等于 drawingbuffer

## 让画布填充满窗口该怎么做（要求 drawingbuffer 等于画布的显示尺寸）？

- 首先使用 CSS 让浏览器将画布铺满窗口

- 将 drawingbuffer 的尺寸设置为为浏览器拉伸后的画布尺寸。

## 画布填充满窗口代码实现

```html:no-line-numbers
<html>
  <head>
    <style>
      /* 移除边界 */
      body {
        border: 0;
        background-color: white;
      }
      /* 设置欢度大小为视域大小 */
      canvas {
        width: 100vw;
        height: 100vh;
        display: block;
      }
    <style>
  </head>
  <body>
    <canvas id="c"></canvas>
  </body>
</html>
```

```js:no-line-numbers
function resize(canvas) {
  // 获取浏览器中画布的显示尺寸
  var displayWidth  = canvas.clientWidth;
  var displayHeight = canvas.clientHeight;
  // 检尺寸是否相同
  if (canvas.width  != displayWidth ||
      canvas.height != displayHeight) {
    // 设置为相同的尺寸
    canvas.width  = displayWidth;
    canvas.height = displayHeight;
  }
}
```

## gl.viewport 设置视域

一个很重要的概念==视域大小==

默认：第一次创建 WebGL 上下文的时候 WebGL 会设置视域大小和画布大小匹配。

但是在那之后你改变画布大小，就需要告诉 WebGL 新的视域设置。否则就算修改 drawingbuffer 等于画布的显示尺寸，图形也不会放到正确得视域内部。
[后果](https://webglfundamentals.org/webgl/webgl-resize-canvas.html)

我知道你会问，为什么 WebGL 不在画布尺寸改变的时候自动帮我们修改视域？ 原因是它不知道你如何以及为什么使用视域， 你可以渲染到一个帧缓冲或者做其他的事情需要不同的视域尺寸。 WebGL 没办法知道你的意图所以就不能自动帮你设置视域。

## 总结形成工具

- 设置 gl.viewport，最佳入参方式

```js:no-line-numbers
gl = canvas.getContext("webgl");
gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
```

- 使用 canvas.clientWidth 和 canvas.clientHeight，这些值可以告诉你画布显示在屏幕上的实际尺寸。 这样就可以不用关心 CSS 设置，得到正确的长宽比。
