---
article: false
prev: false
next: false
category:
  - WebAssembly
tag:
  - WebAssembly
---

# ååˆ†é’Ÿææ‡‚ WebAssembly

WebAssembly è¿è¡Œæå¿«ï¼Œå¯ä»¥ç†è§£ä¸º Web æ±‡ç¼–ï¼ˆweb assemblyï¼‰

<!-- more -->

## æ±‡ç¼–

- æ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰ä¸€ä¸ªç±»ä¼¼ x86 æˆ– ARM çš„æ¶æ„ã€‚æ­¤å¤–ï¼Œå¤„ç†å™¨åªèƒ½ç†è§£æœºå™¨ç ã€‚
- ç¼–å†™æœºå™¨ç æ˜¯ä»¶ä¹å‘³çš„äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨æ±‡ç¼–è¯­è¨€æ¥ç¼–å†™ã€‚
- æ±‡ç¼–ç¨‹åºå°†æ±‡ç¼–è¯­è¨€ä¸­çš„æŒ‡ä»¤è½¬æ¢ä¸ºå¤„ç†å™¨èƒ½ç†è§£çš„æœºå™¨ç ã€‚

## æ€ä¹ˆç†è§£ WebAssembly(WASM)

WASM ä¸æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ ğŸ™‚ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒæ˜¯ä¸€ç§å°†ç”¨ä¸€ç§ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ä»£ç è½¬æ¢ä¸ºæµè§ˆå™¨å¯ç†è§£çš„æœºå™¨ä»£ç çš„æŠ€æœ¯ï¼ˆè¿‡ç¨‹ï¼‰ã€‚æœ€ç»ˆå½¢æˆä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶(.WASM)ã€‚

**æ³¨æ„ï¼šä¸åŒç»ˆç«¯å¯¹äºŒè¿›åˆ¶è¦æ±‚ä¸ä¸€è‡´ï¼Œæ‰€ä»¥æ¶‰åŠåˆ°çš„è½¬åŒ–æŠ€æœ¯ä¹Ÿä¸åŒï¼Œæˆ‘ä»¬è¿™é‡Œä¸»è¦è®²æµè§ˆå™¨æœ‰å…³çš„ã€‚**

## WebAssembly(WASM)é‡‡ç”¨çš„æŠ€æœ¯æ‰‹æ®µæˆ–è€…å·¥å…·

æˆ‘ä»¬æœ‰å¤šç§æ–¹æ³•å¯ä»¥å°†é«˜çº§è¯­è¨€ä»£ç è½¬æ¢ä¸º WASMï¼Œä½†æ˜¯åœ¨äº†è§£ä¹‹å‰è¦çŸ¥é“ç°é˜¶æ®µé‚£äº›ä¸»æµåœ¨è¿™æ ·åšã€‚

- ç¼–è¯‘ C/C++ ä¸º WebAssembly

  å½“ä½ åœ¨ç”¨ C/C++ ä¹‹ç±»çš„è¯­è¨€ç¼–å†™æ¨¡å—æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ Emscripten æ¥å°†å®ƒç¼–è¯‘åˆ° WebAssemblyã€‚

  - Emscripten

    - è°ƒç”¨ç¼–è¯‘å™¨å‰ç«¯ Clang æŠŠ C/C++ä»£ç ç¼–è¯‘æˆ LLVM å­—èŠ‚ç 
    - è°ƒç”¨ç¼–è¯‘å™¨åç«¯ Fastcomp æŠŠ LLVM å­—èŠ‚ç ç¼–è¯‘æˆ asm.jsã€‚è¿™ä¸ª js å…¶å®å·²ç»åœ¨å¤§éƒ¨åˆ†æµè§ˆå™¨ç§æ”¯æŒ
    - è°ƒç”¨ Binaryen çš„ asm2wasm æŠŠ asm.js è½¬æ¢æˆ WASM å­—èŠ‚ç 

* ç¼–è¯‘ Rust ä¸º WebAssembly

* Go è¯­è¨€ ç¼–è¯‘æˆ wasm

```sh
GOARCH=wasm GOOS=js go build -o test.wasm main.go
```

- C#ç¼–è¯‘æˆ wasm

å¼€æºé¡¹ç›®

- walt ç¼–è¯‘æˆ wasm

å¼€æºé¡¹ç›®

```sh
npm i walt-cli
walt -- test.walt -o test.wasm
```

- TypeScript (AssemblyScript) ç¼–è¯‘æˆ wasm

å¼€æºé¡¹ç›®

- eos ä¸­ç¼–è¯‘æˆ wast

eosiocpp -o test.wast test.cpp

**wast/wat æ ¼å¼æ˜¯ wasm çš„æ–‡æœ¬ç±»å‹æ ¼å¼ï¼Œä½¿ç”¨çš„æ˜¯ lisp è¯­è¨€çš„ S è¡¨è¾¾å¼ã€‚ å¯ä»¥ ä½¿ç”¨å·¥å…·å°† wasm è½¬æ¢æˆ wast/wat æ ¼å¼ï¼ŒåŒæ ·æ–‡æœ¬æ ¼å¼ä¹Ÿå¯è½¬æ¢ä¸º wasm**

## æµè§ˆå™¨å¦‚ä½•ä½¿ç”¨ wasm

- JS è°ƒç”¨ wasmï¼Œéœ€è¦å…ˆ fetch, ä¹‹åéœ€è¦ arrayBuffer, å†è¿›è¡Œ instantiate

```c
// cæºç =>è½¬ä¸ºmath.wasm
int fib(int n)
{
   if (n <= 1)
      return n;
   return fib(n-1) + fib(n-2);
}
```

```js
let fibc;
function loadWebAssembly(fileName) {
  return fetch(fileName)
    .then((response) => response.arrayBuffer())
    .then((buffer) => WebAssembly.compile(buffer))
    .then((module) => {
      return new WebAssembly.Instance(module);
    });
}
//We call the function for math.wasm for the given Instance.
loadWebAssembly("math.wasm").then((instance) => {
  fibc = instance.exports._Z3fibi; // _Z3fibiè½¬åŒ–åçš„åå­—
});
```

- ä½¿ç”¨è½¬åŒ–åçš„æ–¹æ³•æˆ–è€…å˜é‡

**ç”±äºé«˜çº§è¯­è¨€åœ¨è½¬ wasm çš„æ—¶è¿›è¡Œäº†ä»£ç è½¬åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆéš¾å†æ‰¾åˆ°é«˜çº§è¯­è¨€åœ¨çš„å‡½æ•°åå’Œå˜é‡åï¼Œä¸ºæ­¤éœ€è¦ç¼–å†™äººå‘˜é…åˆã€‚**

```js
fibc(555);
```
